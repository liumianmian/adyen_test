define("baselinerates/views/app",["jquery","underscore","backbone","d3","chartutil/backbone/r2d3app","baselinerates/views/totalsTitle","baselinerates/views/ui/baselineUI","baselinerates/views/charts/baseLineChart","baselinerates/views/charts/baseLineRollOver","baselinerates/views/charts/baseLineStackedChart","timeline/views/timelineFacade","timeline/util/timelineConstants","charts/baselineRates/app/models/appstate","chartlib/chartLoadQueue","baselinerates/collections/baselineData","chartlib/events/appstateevents","chartlib/chartBaseEvents","chartlib/ui/snapshot"],function(c,r,a,q,m,g,k,e,f,o,b,i,h,s,j,p,l,d){var n=m.extend({el:c(".chart-container"),hasLoadQueue:true,initialize:function(){r.bindAll(this,"setLoadListeners","onLoadSuccess","onLoadFailed","enable","disable");
this.initModels();this.initCollections();a.on(p.CHANGE_REQUESTED,this.disable);a.on(p.STATE_CHANGED,this.setLoadListeners);
if(this.hasLoadQueue){a.on(p.RENDER_CHARTS,this.enable,this);}this.initViews();this._super();},initModels:function(){this.appState=new h();
},initCollections:function(){if(this.hasLoadQueue){this.loadQueue=new s();}this.baselineData=new j();},initViews:function(){var x=new g({el:'[data-view="totalsTitle"]',collection:this.baselineData});
var y=new k({collection:this.baselineData});var w=new e({el:'[data-view="ratesChart"]',collection:this.baselineData,percentile:true,xAttr:"utcdate",yAttr:"authRate",averageAttr:"averageRate",joinAttr:"utcdate"});
var v=new f({el:'[data-view="authorisationsRollOver"]',collection:this.baselineData,xAttr:"date",yAttr:"total",joinAttr:"date"});
var u=new o({el:'[data-view="sessionsStackedChart"]',collection:this.baselineData,xAttr:"date",yAttr:"total",yNestAttr:"rates",joinAttr:"date"});
this.timeline=new b({version:7,timeCollectionMode:i.__LATEST,formatPeriod:i.__MONTH_FORMAT,baseGranularity:i.__DAY_GRANULARITY,calendar:true,controls:true,loadQueue:this.hasLoadQueue,presets:[i.__PRESET_LAST_30_DAYS],config:true,chartGranularity:i.__DAY_FORMAT,chartGranularityDisabled:true,forceCET:false});
this.appState.addConfig({timeline:this.timeline,config:this.configUI,hasMap:false});var t=new d({el:".baseline-rates-snapshot",snapshotEl:".transaction-chart.rates",styleSheets:["chartlib/css/modules.css","baselineRates/css/modules.css"],title:"Baseline rates",timeline:this.timeline});
t=new d({el:".sessions-stacked-snapshot",snapshotEl:".transaction-chart.sessions",styleSheets:["chartlib/css/modules.css","baselineRates/css/modules.css"],title:"Baseline sessions",timeline:this.timeline});
},setLoadListeners:function(){c.when(this.baselineData.getLoaded()).then(this.onLoadSuccess,this.onLoadFailed);},onLoadSuccess:function(){if(this.baselineData.getMaxAuthrate()>1){this.$('[data-view="authRateInfo"]').show();
}else{this.$('[data-view="authRateInfo"]').hide();}var t=this;if(!this.hasLoadQueue){setTimeout(function(){a.trigger(l.DATA_LOADED);
t.enable();},1000);}else{setTimeout(function(){a.trigger(l.DATA_LOADED);},1000);}},onLoadFailed:function(t){if(window.console&&window.console.log){window.console.log("### app::onLoadFailed:: ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^");
}if(this.hasLoadQueue){a.trigger(l.DATA_LOADED);}},enable:function(){this.$el.css("pointer-events","auto");q.selectAll(this.$el).selectAll("rect").style("pointer-events","auto");
this.$el.fadeTo(500,1);},disable:function(){this.$el.css("pointer-events","none");q.selectAll(this.$el).selectAll("rect").style("pointer-events","none");
this.$el.fadeTo(0,0.35);}});return n;},function(a){if(window.console&&window.console.log){window.console.log("APP JS ERROR = "+a);
}});